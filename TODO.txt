Redo complete lib in a way that it will be more generic and more usable.